<?phpif (!defined("_BASE_DIR_")) exit();include_model('Societa');include_controller('FormSocieta');//error_reporting(E_ALL);//ini_set('display_errors', 1);class ModificaSocietaCtrl {		private $form;	private $soc;        private $poliz;		/**	 * @param int $idsoc	 * @param boolean $completo true per modificare tutti i dati	 * @param callable $callback funzione da chiamare in caso di operazione effettuata correttamente	 */	public function __construct($idsoc, $completo, $callback)	{		$this->soc = new Societa($idsoc);               				if (!$this->soc->esiste()) 			go_home();				$f = new FormSocieta('modifica_societa', $this->soc, $completo);		$this->form = $f;                $POST_polizza = empty ($_POST['polizze_assicurative']) ? NULL : $_POST['polizze_assicurative'];		 $this->poliz = new Polizza('polizze_stipulate');		if($f->isInviato())		{			if($f->isValido())			{				$this->soc = $f->getSocieta();				$this->soc->salva();                                $array_dati_polizza = array("id_polizza"=>$POST_polizza,"idtesserato"=>0,"idsocieta"=>$idsoc,"data_stipula"=>date("d-m-Y"),"data_da"=>NULL, "data_a"=>NULL,"tipo_polizza"=>"1");                                                                $this->poliz->setDati($array_dati_polizza);                                                                       $this->poliz->salva();                                $array_assicurazioni = $this->poliz->getAllPolizRichieste();                                 $this->poliz->creaFileExcelPoliz($array_assicurazioni);				if(is_callable($callback))					call_user_func($callback,$this->soc);			}			else			{				foreach ($this->form->getErrori() as $nome => $err) {					switch ($err) {						case FORMERR_OBBLIG:							$msg = 'Campo obbligatorio';							break;						case FORMERR_FORMAT:							$msg = 'Formato non valido';							break;						case FORMERR_DATA_MAX:							$msg = 'La data dev\'essere nel passato';							break;						default:							$msg = "Errore $err";							break;					}					$this->err[$nome] = $msg;				}			}		}	}		public function getForm()	{		return $this->form;	}		public function getErrore($nome) {		if (isset($this->err[$nome]))			return $this->err[$nome];		else			return '';	}}